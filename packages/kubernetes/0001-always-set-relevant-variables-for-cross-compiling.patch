From 8da576bc1d36d9111e817864a80a5d7d3b4c3c56 Mon Sep 17 00:00:00 2001
From: Ben Cressey <bcressey@amazon.com>
Date: Sat, 18 May 2019 16:57:12 +0000
Subject: [PATCH 1/2] always set relevant variables for cross compiling

Signed-off-by: Ben Cressey <bcressey@amazon.com>
---
 hack/lib/golang.sh | 47 +++++++++++++++++++++++-----------------------
 1 file changed, 24 insertions(+), 23 deletions(-)

diff --git a/hack/lib/golang.sh b/hack/lib/golang.sh
index 7ddc0bb7..8b8325c9 100755
--- a/hack/lib/golang.sh
+++ b/hack/lib/golang.sh
@@ -309,29 +309,30 @@ kube::golang::set_platform_envs() {
   export GOOS=${platform%/*}
   export GOARCH=${platform##*/}
 
-  # Do not set CC when building natively on a platform, only if cross-compiling from linux/amd64
-  if [[ $(kube::golang::host_platform) == "linux/amd64" ]]; then
-    # Dynamic CGO linking for other server architectures than linux/amd64 goes here
-    # If you want to include support for more server platforms than these, add arch-specific gcc names here
-    case "${platform}" in
-      "linux/arm")
-        export CGO_ENABLED=1
-        export CC=arm-linux-gnueabihf-gcc
-        ;;
-      "linux/arm64")
-        export CGO_ENABLED=1
-        export CC=aarch64-linux-gnu-gcc
-        ;;
-      "linux/ppc64le")
-        export CGO_ENABLED=1
-        export CC=powerpc64le-linux-gnu-gcc
-        ;;
-      "linux/s390x")
-        export CGO_ENABLED=1
-        export CC=s390x-linux-gnu-gcc
-        ;;
-    esac
-  fi
+  # Dynamic CGO linking for other server architectures goes here
+  # If you want to include support for more server platforms than these, add arch-specific gcc names here
+  case "${platform}" in
+    "linux/amd64")
+      export CGO_ENABLED=1
+      export CC=x86_64-thar-linux-gnu-gcc
+      ;;
+    "linux/arm")
+      export CGO_ENABLED=1
+      export CC=arm-thar-linux-gnueabihf-gcc
+      ;;
+    "linux/arm64")
+      export CGO_ENABLED=1
+      export CC=aarch64-thar-linux-gnu-gcc
+      ;;
+    "linux/ppc64le")
+      export CGO_ENABLED=1
+      export CC=powerpc64le-thar-linux-gnu-gcc
+      ;;
+    "linux/s390x")
+      export CGO_ENABLED=1
+      export CC=s390x-thar-linux-gnu-gcc
+      ;;
+  esac
 }
 
 kube::golang::unset_platform_envs() {
-- 
2.21.0

